<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Billing | Queueless</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root{
            --primary:#6366f1;
            --bg:#0f172a;
            --border:rgba(255,255,255,.2);
            --success:#22c55e;
            --danger:#ef4444;
        }

        *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,sans-serif;}

        body{
            background:radial-gradient(circle at top,#6366f1,#0f172a 60%);
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:20px;
            color:white;
        }

        .card{
            width:100%;
            max-width:420px;
            background:linear-gradient(180deg,rgba(255,255,255,.16),rgba(255,255,255,.08));
            backdrop-filter:blur(20px);
            border:1px solid var(--border);
            border-radius:22px;
            padding:28px;
            box-shadow:0 25px 50px rgba(0,0,0,.4);
        }

        h2{
            text-align:center;
            margin-bottom:20px;
        }

        .section{
            background:rgba(255,255,255,.12);
            border-radius:16px;
            padding:18px;
        }

        .row{
            display:flex;
            justify-content:space-between;
            margin-bottom:10px;
        }

        .badge{
            padding:6px 12px;
            border-radius:999px;
            font-size:.8rem;
            font-weight:600;
        }

        .success{background:rgba(34,197,94,.2);border:1px solid rgba(34,197,94,.4)}
        .danger{background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.4)}

        button{
            width:100%;
            padding:14px;
            margin-top:16px;
            border:none;
            border-radius:14px;
            background:linear-gradient(135deg,#22c55e,#16a34a);
            color:white;
            font-weight:600;
            cursor:pointer;
        }

        .note{
            font-size:.85rem;
            opacity:.85;
            margin-top:10px;
        }
    </style>
</head>

<body>

<div class="card">
    <h2>ðŸ’³ Billing & Subscription</h2>

    <div class="section">
        <div class="row">
            <span>Current Plan</span>
            <b id="plan">â€”</b>
        </div>

        <div class="row">
            <span>Status</span>
            <span id="status"></span>
        </div>

        <button id="payBtn" style="display:none" onclick="pay()">
            ðŸš€ Pay & Activate
        </button>

        <p class="note">
            Secure payments powered by Razorpay
        </p>
    </div>
</div>

<script>
    const API="http://localhost:8080";
    const jwt=localStorage.getItem("jwt");
    const selectedPlan=localStorage.getItem("selectedPlan");

    if(!jwt) location.href="/login.html";
    if(!selectedPlan) location.href="/pricing.html";

    plan.innerText = selectedPlan;

    /* Assume not active until paid */
    status.innerHTML =
        `<span class="badge danger">Inactive</span>`;
    payBtn.style.display="block";

    /* ===============================
       RAZORPAY PAYMENT
    =============================== */
    async function pay(){
        try{
            const res = await fetch(
                `${API}/api/admin/payment/create-order?plan=${selectedPlan}`,
                {
                    method:"POST",
                    headers:{
                        "Authorization":"Bearer "+jwt
                    }
                }
            );

            if(!res.ok) throw new Error(await res.text());
            const order = await res.json();

            const options = {
                key: order.key,
                amount: order.amount,
                currency: order.currency,
                order_id: order.orderId,
                name: "Queueless",
                description: selectedPlan + " Subscription",
                handler: function () {
                    alert("âœ… Payment successful!");
                    localStorage.removeItem("selectedPlan");
                    location.href="/dashboard.html";
                },
                theme:{ color:"#6366f1" }
            };

            new Razorpay(options).open();

        }catch(e){
            alert("Payment failed: "+e.message);
        }
    }
</script>

</body>
</html>
